<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Loading Bar with Time</title>
    <style>
      body {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 0;
        background-color: #f5f5f5;
        font-family: Arial, sans-serif;
      }

      .loading-container {
        width: 300px;
        margin: 20px auto;
      }

      #contentFrame {
        width: 300px;
        height: 100px;
        border: 1px solid #ccc;
        margin: 20px 0;
      }
    </style>
    <script src="./payment-widget.js"></script>
  </head>
  <body>
    <div class="loading-container">
      <iframe id="payment-widget"></iframe>
      <button onclick="readFrame();">Read my data</button>
    </div>

    <script>

        async function readFrame() {
          // Wait for iframe to load (use load event for external URLs)
          const frame = document.getElementById('payment-widget');
          processFrame(frame);
        }

        const processFrame = async (frame) => {
          try {
            // Capture iframe content
            const canvas = await html2canvas(frame.contentDocument.body, {
              allowTaint: true,
              useCORS: false,
              windowWidth: frame.scrollWidth,
              windowHeight: frame.scrollHeight
            });

            let image = canvas.toDataURL("image/png", 0.5);

            // Create an img element and append it to the page
            var screenshotImg = document.createElement('img');
            screenshotImg.src = image;
            screenshotImg.style.width = '100%'; // Optional: Set the width of the screenshot image
            screenshotImg.style.marginTop = '20px'; // Optional: Add some margin for better visibility

            // Append the screenshot image to the page
            document.body.appendChild(screenshotImg);
  
            // Perform OCR
            const { data: { text } } = await Tesseract.recognize(
              canvas.toDataURL('image/png'),
              'eng',
              { logger: m => console.log(m.status) }
            );
  
            console.log('FOUND:', text);
            alert('FOUND: ' + text);
            
          } catch (error) {
            console.error('Error:', error);
          }
        };

      (async () => {
        var widget = new PaymentWidget({
            container: 'payment-widget', // Fix here (pass ID, not element)
            amount: 1000,
            currency: 'EUR',
            publicKey: 'pk_test_6e40a700-8b0b-11eb-8dcd-0242ac130003',
            onSuccess: function(response) {
                console.log('Success:', response);
            },
            onError: function(error) {
                console.log('Error:', error);
            }
        });

        widget.render();

        // Load required libraries
        const loadScript = (src) => new Promise((resolve) => {
          const script = document.createElement('script');
          script.src = src;
          script.onload = resolve;
          document.head.appendChild(script);
        });
  
        await loadScript('https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js');
        await loadScript('https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js');
      })();
    </script>
      
  </body>
</html>
